# ============================================
# BULQ UNIFIED ENVIRONMENT CONFIGURATION
# ============================================
# Switch between development and production by changing ENV variable only.
# All other variables automatically select the correct values.
#
# SETUP: Copy this file to .env and configure:
#   cp .env.example .env
# ============================================

# ============================================
# ENVIRONMENT SELECTOR
# ============================================
# Options: "development" or "production"
ENV=development

# ============================================
# DEVELOPMENT-SPECIFIC VALUES
# ============================================
DEV_SECRET_KEY=dev-secret-key-not-for-production
DEV_SECURE_COOKIES=false
DEV_POSTGRES_PASSWORD=bulq_dev_pass
DEV_REPO_MODE=memory
DEV_ALLOWED_ORIGINS=
DEV_CADDY_LISTEN=localhost:3000
DEV_CADDY_PORT=3000
DEV_FRONTEND_PORT=3000
DEV_BACKEND_PORT=8000
DEV_BUILD_DEV_DEPS=true
DEV_LOG_FORMAT=structured
DEV_LOG_FILE=
DEV_DB_POOL_SIZE=5
DEV_DB_MAX_OVERFLOW=5
DEV_VITE_BASE_PATH=/

# ============================================
# PRODUCTION-SPECIFIC VALUES
# ============================================
# REQUIRED: Generate with: openssl rand -hex 32
PROD_SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_KEY

PROD_SECURE_COOKIES=true

# REQUIRED: Change to a strong password (16+ characters)
PROD_POSTGRES_PASSWORD=REPLACE_WITH_STRONG_PASSWORD

PROD_REPO_MODE=database

# REQUIRED: Set to production domain
PROD_ALLOWED_ORIGINS=https://bulq.vagolan.com

PROD_CADDY_LISTEN=:80
PROD_CADDY_PORT=80
PROD_FRONTEND_PORT=8080
PROD_BACKEND_PORT=
PROD_BUILD_DEV_DEPS=false
PROD_LOG_FORMAT=json
PROD_LOG_FILE=/app/logs/app.log
PROD_DB_POOL_SIZE=20
PROD_DB_MAX_OVERFLOW=10
PROD_VITE_BASE_PATH=/

# ============================================
# AUTO-SELECTED VARIABLES
# ============================================
# These automatically use PROD values if ENV=production, otherwise DEV values.
# You only need to change ENV above!
# ============================================

# Set PROD flag if ENV=production
PROD=${ENV:+${ENV}}
PROD=${PROD/development/}

# Security
SECRET_KEY=${PROD:+${PROD_SECRET_KEY}}
SECRET_KEY=${SECRET_KEY:-${DEV_SECRET_KEY}}

SECURE_COOKIES=${PROD:+${PROD_SECURE_COOKIES}}
SECURE_COOKIES=${SECURE_COOKIES:-${DEV_SECURE_COOKIES}}

# Database
POSTGRES_DB=bulq
POSTGRES_USER=bulq

POSTGRES_PASSWORD=${PROD:+${PROD_POSTGRES_PASSWORD}}
POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-${DEV_POSTGRES_PASSWORD}}

DATABASE_URL=postgresql://bulq:${POSTGRES_PASSWORD}@db:5432/bulq

# Database Pool
DB_POOL_SIZE=${PROD:+${PROD_DB_POOL_SIZE}}
DB_POOL_SIZE=${DB_POOL_SIZE:-${DEV_DB_POOL_SIZE}}

DB_MAX_OVERFLOW=${PROD:+${PROD_DB_MAX_OVERFLOW}}
DB_MAX_OVERFLOW=${DB_MAX_OVERFLOW:-${DEV_DB_MAX_OVERFLOW}}

DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Repository
REPO_MODE=${PROD:+${PROD_REPO_MODE}}
REPO_MODE=${REPO_MODE:-${DEV_REPO_MODE}}

# Session
SESSION_EXPIRY_HOURS=24

# CORS
ALLOWED_ORIGINS=${PROD:+${PROD_ALLOWED_ORIGINS}}
ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-${DEV_ALLOWED_ORIGINS}}

# Base Path
VITE_BASE_PATH=${PROD:+${PROD_VITE_BASE_PATH}}
VITE_BASE_PATH=${VITE_BASE_PATH:-${DEV_VITE_BASE_PATH}}

# Docker/Caddy
CADDY_LISTEN=${PROD:+${PROD_CADDY_LISTEN}}
CADDY_LISTEN=${CADDY_LISTEN:-${DEV_CADDY_LISTEN}}

CADDY_PORT=${PROD:+${PROD_CADDY_PORT}}
CADDY_PORT=${CADDY_PORT:-${DEV_CADDY_PORT}}

FRONTEND_PORT=${PROD:+${PROD_FRONTEND_PORT}}
FRONTEND_PORT=${FRONTEND_PORT:-${DEV_FRONTEND_PORT}}

BACKEND_PORT=${PROD:+${PROD_BACKEND_PORT}}
BACKEND_PORT=${BACKEND_PORT:-${DEV_BACKEND_PORT}}

# Build
BUILD_DEV_DEPS=${PROD:+${PROD_BUILD_DEV_DEPS}}
BUILD_DEV_DEPS=${BUILD_DEV_DEPS:-${DEV_BUILD_DEV_DEPS}}

# Logging
LOG_LEVEL=INFO

LOG_FORMAT=${PROD:+${PROD_LOG_FORMAT}}
LOG_FORMAT=${LOG_FORMAT:-${DEV_LOG_FORMAT}}

LOG_FILE=${PROD:+${PROD_LOG_FILE}}
LOG_FILE=${LOG_FILE:-${DEV_LOG_FILE}}

# ============================================
# USAGE INSTRUCTIONS
# ============================================
# DEVELOPMENT MODE:
# 1. Copy: cp .env.example .env
# 2. ENV=development (already default)
# 3. Run: docker compose up
#
# PRODUCTION MODE:
# 1. Copy: cp .env.example .env
# 2. Set ENV=production
# 3. Update PROD_SECRET_KEY (generate with: openssl rand -hex 32)
# 4. Update PROD_POSTGRES_PASSWORD (strong password, 16+ chars)
# 5. Update PROD_ALLOWED_ORIGINS if needed
# 6. In docker-compose.yml, comment out backend volume mount
# 7. Run: docker compose build && docker compose up -d
# 8. Set permissions: chmod 600 .env
#
# All variables automatically switch based on ENV value!
# ============================================
