# ============================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# ============================================
# For deployment at vagolan.com/bulq
#
# ARCHITECTURE:
# - Upstream reverse proxy at vagolan.com handles HTTPS and routes /bulq/* to this app
# - This app runs on HTTP (port 8080 by default) behind the upstream proxy
# - No SSL certificates needed here (handled by upstream proxy)
#
# IMPORTANT: After copying this file to .env, you MUST:
# 1. Generate a strong SECRET_KEY: openssl rand -hex 32
# 2. Set a strong POSTGRES_PASSWORD (at least 16 characters)
# 3. Update DATABASE_URL with the same password
# 4. Review all settings below
# ============================================

# ============================================
# ENVIRONMENT CONFIGURATION
# ============================================
ENV=production

# ============================================
# BASE PATH CONFIGURATION
# ============================================
# Subpath deployment at vagolan.com/bulq
VITE_BASE_PATH=/bulq

# ============================================
# SECURITY CONFIGURATION
# ============================================
# REQUIRED: Generate with: openssl rand -hex 32
SECRET_KEY=REPLACE_WITH_GENERATED_SECRET_KEY

# REQUIRED: Must be true in production (HTTPS required)
SECURE_COOKIES=true

# ============================================
# DATABASE CONFIGURATION
# ============================================
POSTGRES_DB=bulq
POSTGRES_USER=bulq
# REQUIRED: Change to a strong password (16+ characters)
POSTGRES_PASSWORD=REPLACE_WITH_STRONG_PASSWORD

# Automatically constructed from above values
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}

# Database Connection Pool Configuration
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# REQUIRED: Must be "database" in production
REPO_MODE=database

# ============================================
# SESSION CONFIGURATION
# ============================================
SESSION_EXPIRY_HOURS=24

# ============================================
# CORS CONFIGURATION
# ============================================
# REQUIRED: Set to production domain
ALLOWED_ORIGINS=https://vagolan.com

# ============================================
# DOCKER CONFIGURATION
# ============================================
# Caddy listen address (behind upstream reverse proxy)
CADDY_LISTEN=:80

# Port Caddy listens on inside container
CADDY_PORT=80

# Port exposed on host for upstream reverse proxy
# The upstream proxy will forward vagolan.com/bulq/* to this port
FRONTEND_PORT=8080

# Backend port (leave empty - not exposed in production)
BACKEND_PORT=

# Backend hot-reload (disabled in production)
BACKEND_VOLUME=/dev/null

# ============================================
# BUILD CONFIGURATION
# ============================================
# Exclude dev dependencies in production
BUILD_DEV_DEPS=false

# ============================================
# LOGGING CONFIGURATION
# ============================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/app/logs/app.log

# ============================================
# SETUP INSTRUCTIONS
# ============================================
# 1. Copy this file:
#    cp .env.production .env
#
# 2. Generate SECRET_KEY:
#    openssl rand -hex 32
#    Then replace REPLACE_WITH_GENERATED_SECRET_KEY above
#
# 3. Set strong database password:
#    Replace REPLACE_WITH_STRONG_PASSWORD in POSTGRES_PASSWORD
#    (DATABASE_URL will be automatically constructed from it)
#
# 4. Deploy:
#    docker compose build
#    docker compose up -d
#
# 5. Verify:
#    docker compose ps
#    docker compose logs -f
#    curl https://vagolan.com/bulq
#
# ============================================
# SECURITY CHECKLIST
# ============================================
# [ ] Strong SECRET_KEY generated (32+ chars)
# [ ] Strong database password set (16+ chars)
# [ ] ENV=production
# [ ] SECURE_COOKIES=true
# [ ] ALLOWED_ORIGINS=https://vagolan.com
# [ ] VITE_BASE_PATH=/bulq
# [ ] REPO_MODE=database
# [ ] FRONTEND_PORT=8080
# [ ] Upstream reverse proxy configured and tested
# [ ] Firewall allows port 8080 from upstream proxy server
# [ ] .env file permissions: chmod 600 .env
# [ ] Backend port NOT exposed to internet (internal only)
# [ ] Database port NOT exposed to internet (internal only)
